on:
   push:
   workflow_dispatch:
   
env:  
  containertag: ghcr.io/rajbos/testing-snyk
  containerhost: https://ghcr.io
   
jobs:
  build:

    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
       
      - name: Build the Docker image
        run: docker build -t $containertag .
      
      - name: Run Snyk to check Docker image for vulnerabilities
        uses: rajbos-actions/snyk-actions/docker@master
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
        with:
          args: --file=Dockerfile
        continue-on-error: true

      - name: Upload Snyk scan result to GitHub Code Scanning
        uses: github/codeql-action/upload-sarif@v1
        with:
          sarif_file: snyk.sarif
